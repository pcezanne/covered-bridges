from itertools import product
from sys import stdout as out
from mip import Model, xsum, minimize, BINARY

dists = [
	[12178, 13595, 16909, 21082, 22097, 65713, 88747, 94863, 105391, 103778, 94849, 121862, 118507, 85507, 55018, 52002, 98438, 102618, 100807, 105354, 116757, 151622, 189494, 197048, 198632, 252549, 252583, 274745, 307793, 329762, 340331, 343321, 285457, 219168, 185053, 191914, 190293, 185683, 207398, 211927, 234465, 234444, 258995, 253622, 255292, 86887, 87707, 128655, 81921, 216635, 175550, 129464],
	[2254, 5568, 9741, 10757, 54372, 77406, 83522, 94050, 92437, 83508, 110521, 107166, 74166, 43677, 42913, 88481, 92661, 90851, 95397, 106800, 141665, 179537, 187091, 188675, 242593, 242626, 264789, 297836, 319806, 330374, 333364, 275500, 207827, 173712, 180573, 178952, 174342, 196057, 200586, 223124, 223103, 247654, 242281, 243951, 75546, 76366, 117314, 70580, 205294, 164209, 119508],
	[3578, 7751, 8911, 52382, 75416, 81532, 92060, 90447, 81518, 108531, 105176, 72176, 41687, 40923, 86491, 90671, 88861, 93407, 104810, 139675, 177547, 185101, 186685, 240602, 240636, 262798, 295846, 317816, 328384, 331374, 273510, 205837, 171722, 178583, 176962, 172352, 194067, 198596, 221134, 221113, 245664, 240291, 241961, 73556, 74376, 115324, 68590, 203304, 162219, 117518],
	[5179, 7327, 49810, 72844, 78960, 89488, 87875, 78946, 105959, 102604, 69604, 39115, 38351, 83919, 88099, 86288, 90835, 102238, 137103, 174975, 182529, 184113, 238030, 238064, 260226, 293274, 315244, 325812, 328802, 270938, 203265, 169150, 176011, 174390, 169780, 191494, 196024, 218562, 218541, 243092, 237719, 239389, 70984, 71804, 112752, 66018, 200732, 159647, 114945],
	[4319, 47097, 70131, 76247, 86775, 85162, 76233, 103246, 99891, 66891, 36402, 35638, 81206, 85386, 83575, 88122, 99525, 134390, 172262, 179816, 181400, 235317, 235351, 257513, 290561, 312531, 323099, 326089, 268225, 200552, 166437, 173298, 171677, 167067, 188781, 193311, 215849, 215828, 240379, 235006, 236676, 68271, 69091, 110039, 63305, 198019, 156934, 112232],
	[51416, 74449, 80565, 91093, 89481, 80552, 107565, 104210, 71209, 40720, 39956, 85524, 89705, 87894, 92440, 103844, 138709, 176581, 184135, 185718, 239636, 239669, 261832, 294879, 316849, 327418, 330408, 272544, 204871, 170756, 177617, 175995, 171386, 193100, 197629, 220168, 220147, 244698, 239325, 240995, 72589, 73409, 114358, 67624, 202337, 161252, 116551],
	[39508, 45624, 56152, 54540, 45611, 72623, 69268, 62978, 49637, 54105, 83240, 83992, 84119, 90242, 90888, 145860, 183732, 191286, 193789, 226662, 226697, 236848, 272302, 299617, 309450, 312440, 247560, 169929, 135814, 142676, 141054, 136445, 158159, 162688, 185227, 185206, 209757, 204384, 206054, 64358, 65178, 79416, 32682, 167396, 126311, 103152],
	[7830, 18672, 23450, 21907, 47256, 43901, 48505, 69069, 73537, 73257, 74210, 74135, 101075, 85336, 120514, 158386, 165939, 157831, 190703, 190738, 200890, 236344, 263658, 273491, 276481, 211601, 133971, 99856, 106717, 105096, 100486, 122200, 126730, 149268, 149247, 173798, 168425, 170095, 50667, 51487, 39577, 9268, 131437, 90353, 77806],
	[11640, 16385, 25609, 31129, 36837, 59444, 75186, 79653, 103656, 91457, 93290, 94011, 78271, 113449, 151321, 158875, 155882, 188755, 188790, 198941, 234395, 261710, 271543, 274533, 209653, 132022, 97907, 104769, 103147, 98538, 120252, 124781, 147319, 147299, 171850, 166476, 168147, 54368, 55188, 32324, 15384, 129489, 88404, 70741],
	[4373, 13597, 28649, 25294, 40194, 68584, 77079, 92113, 79913, 81747, 82468, 66728, 101906, 139778, 147332, 148916, 164142, 164177, 174328, 209782, 280047, 246930, 249920, 185040, 107409, 73294, 80156, 78534, 73925, 95639, 100168, 122706, 122685, 147237, 141863, 143534, 42356, 43176, 28573, 25338, 104876, 63791, 59198],
	[9764, 28028, 24673, 36361, 64751, 73247, 61114, 62067, 61992, 81846, 66107, 101285, 139157, 146711, 148295, 203521, 203556, 213708, 249162, 279425, 289994, 292984, 224419, 146789, 112674, 119535, 117914, 113304, 135018, 139548, 162086, 162065, 186616, 181243, 182913, 38523, 39343, 32001, 24224, 144256, 103171, 58577],
	[27799, 24444, 26659, 55049, 63544, 51411, 52364, 52290, 58413, 65857, 101035, 138907, 146461, 148045, 175605, 175640, 185792, 221246, 279176, 289745, 292734, 196503, 118873, 84758, 91619, 89997, 76846, 107104, 111633, 134171, 134150, 158700, 153328, 154999, 28821, 29641, 41225, 15246, 116339, 75254, 58327],
	[3351, 41586, 71836, 80331, 85798, 73598, 75432, 76153, 60413, 95591, 133463, 141017, 119126, 151998, 152033, 162185, 197639, 224953, 234786, 237776, 172896, 95266, 61151, 68012, 66391, 53239, 83497, 88026, 110565, 110544, 135093, 129722, 131392, 43248, 44068, 20104, 42262, 92733, 51648, 52883],
	[38228, 68477, 76973, 82440, 70240, 72074, 72794, 57055, 92233, 130105, 137658, 118281, 151154, 151189, 161340, 196794, 224108, 233942, 236931, 172052, 94421, 60306, 67167, 65546, 52394, 82652, 87182, 109720, 109699, 134248, 128877, 130547, 39890, 40710, 23066, 38903, 91888, 50803, 49525],
	[37080, 46277, 31026, 31979, 31904, 38028, 42917, 78095, 115967, 123521, 125105, 179022, 179055, 201218, 234266, 256235, 266804, 269794, 211930, 132686, 98571, 105432, 103811, 91320, 120917, 125447, 147985, 147964, 172513, 167142, 168812, 10487, 11307, 61330, 41934, 130153, 89068, 35387],
	[8833, 44019, 45175, 43365, 50935, 54233, 97204, 135076, 142630, 144214, 198131, 198164, 220327, 253375, 275344, 285913, 288903, 231039, 162928, 128813, 135674, 134053, 133957, 151159, 155689, 178227, 178206, 209302, 255619, 262327, 37957, 35073, 91573, 62243, 163687, 119310, 75046],
	[40870, 45051, 43240, 47786, 52019, 94055, 131927, 139481, 141064, 194982, 195015, 217178, 250225, 272195, 282764, 285754, 227890, 166777, 139151, 146013, 144391, 130808, 191203, 195732, 218271, 218250, 206153, 252470, 259178, 37286, 36466, 99084, 65726, 160538, 159355, 71897],
	[3758, 1947, 7002, 19388, 54825, 92696, 100250, 101834, 155752, 155785, 177948, 210995, 232965, 243534, 246523, 188659, 127547, 99921, 106782, 105161, 91577, 134593, 149247, 178678, 178657, 166923, 213240, 219948, 23749, 22929, 104155, 66652, 121308, 108717, 32667],
	[1834, 10760, 15631, 58582, 96454, 104008, 105592, 159509, 159543, 181705, 214753, 236723, 247291, 250281, 192417, 127764, 93649, 100511, 98889, 85306, 128322, 142976, 165514, 165493, 170681, 216997, 223705, 24612, 23792, 93355, 67592, 125065, 102445, 29372],
	[8949, 17464, 56772, 94644, 102197, 103781, 157699, 157732, 179895, 212942, 234912, 245481, 248470, 190607, 129494, 95483, 102344, 100723, 87139, 130155, 144809, 180625, 180604, 168870, 215187, 221895, 24628, 23808, 95189, 69425, 123255, 104279, 31206],
	[13989, 49512, 87384, 94938, 96522, 150439, 150473, 172635, 205683, 227653, 238221, 241211, 183347, 125756, 91641, 98502, 96881, 83298, 126314, 140968, 173366, 173345, 161611, 207927, 214635, 29511, 28691, 95875, 72413, 115995, 100437, 24387],
	[46998, 84869, 92423, 94007, 147925, 147958, 170121, 203168, 225138, 235707, 238696, 180832, 114579, 80464, 87325, 85704, 72120, 115137, 129790, 152329, 152308, 154406, 205413, 212121, 31508, 30688, 80170, 80079, 112046, 89260, 16187],
	[42013, 41870, 39949, 105069, 105102, 127265, 160312, 182282, 192851, 195840, 137976, 68637, 57867, 64729, 63107, 49524, 92540, 105001, 119768, 119747, 108013, 126734, 133442, 80363, 79543, 93210, 116410, 62397, 66663, 32557],
	[7970, 9554, 57568, 57603, 80785, 129639, 151609, 162178, 165167, 91496, 47320, 67249, 63887, 70366, 63235, 111366, 123827, 98451, 98430, 86696, 99843, 106551, 118855, 118035, 112037, 154902, 41080, 85489, 83505],
	[5588, 49724, 49760, 72941, 107589, 135709, 145543, 148532, 83653, 43353, 63283, 59920, 66400, 72426, 107400, 119861, 94484, 94463, 82729, 91999, 98707, 126103, 125283, 108070, 162150, 37114, 81523, 90753],
	[55185, 55221, 78402, 113050, 141170, 151004, 153993, 89114, 38067, 57997, 54634, 61114, 67140, 102114, 114575, 89198, 89177, 77443, 92048, 98756, 127687, 126867, 102784, 162392, 31828, 76237, 92336],
	[33, 23206, 57854, 85974, 95807, 98797, 33918, 56928, 91445, 88083, 94563, 100589, 135562, 116813, 89313, 89719, 111527, 71443, 78151, 180802, 179982, 136233, 195841, 62261, 109685, 145452],
	[23239, 57887, 86008, 95841, 98830, 33951, 56963, 91481, 88118, 94598, 100624, 135597, 116848, 89348, 89754, 111562, 71478, 78186, 180836, 180016, 136268, 195876, 62296, 109721, 145485],
	[35531, 62845, 72679, 75668, 10901, 67483, 102000, 98637, 105117, 111144, 146117, 132466, 104967, 105372, 116966, 87097, 82620, 203051, 202231, 146787, 206396, 72816, 120240, 167701],
	[27944, 37777, 40767, 46641, 102851, 137368, 134006, 140486, 146512, 181485, 167835, 140335, 140740, 152334, 122465, 118359, 237360, 236540, 182156, 241764, 108184, 155608, 202010],
	[10724, 13714, 73955, 130166, 164683, 161320, 167800, 173826, 208800, 195149, 167649, 168055, 179649, 149779, 145673, 258854, 258034, 209470, 269078, 135499, 182923, 223503],
	[3462, 83788, 139999, 174516, 171153, 177633, 183659, 218633, 204982, 177483, 177888, 189482, 159613, 155507, 269422, 268602, 219303, 278912, 145332, 192756, 234072],
	[86778, 142989, 177506, 174143, 180623, 186649, 221623, 207972, 180472, 180878, 192472, 162602, 158496, 272412, 271592, 222293, 281901, 148321, 195746, 237062],
	[78109, 112626, 109263, 115743, 121770, 125761, 119875, 94935, 92459, 104375, 78216, 71789, 213677, 212857, 157413, 217022, 83442, 130866, 178327],
	[35264, 31901, 38381, 44408, 79381, 91842, 65266, 65245, 53511, 72507, 79215, 134703, 135523, 80052, 139660, 5591, 53504, 101625],
	[5731, 5240, 10007, 44981, 57442, 86220, 86199, 74465, 106804, 113512, 100302, 101122, 45651, 105259, 32105, 19104, 67225],
	[10512, 16518, 51491, 63952, 82038, 82017, 70283, 102622, 109330, 106813, 107633, 52161, 111770, 27923, 25614, 73735],
	[15295, 48172, 60633, 89370, 89349, 77615, 109954, 116662, 105591, 106411, 50939, 110548, 35254, 19319, 72513],
	[44598, 57059, 79597, 79576, 83867, 116207, 122915, 92454, 93274, 45268, 104876, 41507, 18721, 58799],
	[14858, 37397, 37376, 45683, 56554, 58224, 122590, 123410, 68375, 127983, 76105, 31590, 102371],
	[27516, 27495, 35803, 46673, 48343, 127119, 127939, 72904, 132512, 87975, 43459, 114241],
	[405, 11999, 19157, 23386, 150171, 150991, 95956, 155564, 59675, 66511, 137293],
	[11978, 19562, 20911, 150150, 150970, 95935, 155543, 59654, 66490, 137272],
	[27303, 32827, 174435, 175255, 119784, 179392, 47920, 74798, 141358],
	[6708, 169328, 170148, 115113, 174721, 77952, 85668, 173497],
	[171016, 171836, 116801, 176409, 84638, 87356, 180183],
	[820, 62964, 44028, 131786, 90702, 43793],
	[63784, 44848, 132606, 91522, 44613],
	[64447, 76914, 35829, 72577],
	[137022, 95938, 72786],
	[50637, 98758],
	[73533]
]


places = [
"Ashuelot Bridge, Winchester", "Coombs Bridge, Winchester,", "Slate Bridge, Swanzey", "West Swanzey Bridge, Swanzey", "Sawyer's Crossing, Swanzey", "Carleton Bridge, Swanzey", "County Bridge, Hancock", "Rowell's Bridge, Hopkinton", "Railroad Bridge, Hopkinton", "Dalton Bridge, Warner", "Waterloo Bridge, Warner", "Bement Bridge, Bradford", "Keniston Bridge, Andover", "Cilleyville Bridge, Andover", "Corbin Bridge, Newport", "Mcdermott Bridge, Langdon", "Prentiss Bridge, Langdon", "Cornish-Windsor Bridge, Cornish", "Blacksmith Shop Bridge, Cornish", "Dingleton Hill Bridge, Cornish", "Blow-Me-Down Bridge, Cornish", "Meriden Bridge, Plainfield", "Edgell Bridge, Lyme", "Bath-Haverhill Bridge, Bath", "Bath Bridge, Bath", "Swiftwater Bridge, Bath", "Mt.Orne Bridge, Lancaster", "Mechanic Street Bridge, Lancaster", "Groveton Bridge, Northumberland", "Columbia Bridge, Columbia", "Pittsburg-Clarksville Bridge, Pittsburg", "Happy Corner Bridge, Pittsburg", "River Road Bridge, Pittsburg", "Stark Bridge, Stark", "Sentinel Pine Bridge, Lincoln", "Blair Bridge, Campton", "Turkey Jim's Bridge, Campton", "Bump Bridge, Campton", "Smith Bridge, Plymouth", "Durgin Bridge, Sandwich", "Whittier Bridge, Ossipee", "Swift River Bridge", "Saco River Bridge", "Albany Bridge, Albany", "Bartlett Bridge, Bartlett", "Honeymoon Bridge, Jackson", "Pier Bridge, Newport", "Wright's Bridge, Newport", "Sulphite Bridge, Franklin", "Heniker Bridge, Heniker", "Clark's Bridge, North Woodstock", "Squam Bridge, Ashland", "Packard Hill Bridge, Lebanon", 
]


# number of nodes and list of vertices
n, V = len(dists), set(range(len(dists)))

# distances matrix
c = [[0 if i == j
      else dists[i][j-i-1] if j > i
      else dists[j][i-j-1]
      for j in V] for i in V]

model = Model()

# binary variables indicating if arc (i,j) is used on the route or not
x = [[model.add_var(var_type=BINARY) for j in V] for i in V]

# continuous variable to prevent subtours: each city will have a
# different sequential id in the planned route except the first one
y = [model.add_var() for i in V]

# objective function: minimize the distance
model.objective = minimize(xsum(c[i][j]*x[i][j] for i in V for j in V))

# constraint : leave each city only once
for i in V:
    model += xsum(x[i][j] for j in V - {i}) == 1

# constraint : enter each city only once
for i in V:
    model += xsum(x[j][i] for j in V - {i}) == 1

# subtour elimination
for (i, j) in product(V - {0}, V - {0}):
    if i != j:
        model += y[i] - (n+1)*x[i][j] >= y[j]-n

# optimizing
model.optimize()

# checking if a solution was found
if model.num_solutions:
    out.write('route with total distance %g found: %s'
              % (model.objective_value, places[0]))
    nc = 0
    while True:
        nc = [i for i in V if x[nc][i].x >= 0.99][0]
        out.write(' -> %s' % places[nc])
        if nc == 0:
            break
    out.write('\n')
    